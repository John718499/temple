"use strict";(self.webpackChunktemple=self.webpackChunktemple||[]).push([[907],{1907:function(t,e,n){n.r(e),n.d(e,{default:function(){return Z}});var a=n(4165),r=n(5861),i=n(5671),c=n(3144),s=n(136),o=n(9388),u=n(2791),l=n(3504),d=n(6871),h=n(9186),f=n(2677),v=n(6157),m=n(2822),p=n(4221),x=n(3446),g=n(184),y=function(t){(0,s.Z)(n,t);var e=(0,o.Z)(n);function n(t){var c;return(0,i.Z)(this,n),(c=e.call(this,t)).SaveTemplate=(0,r.Z)((0,a.Z)().mark((function t(){var e;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,c.setState({validated:!0});case 2:if(e=c.state.data.slice(0,c.state.num),!e.some((function(t){return c.NameInvalid(t.name)||c.BirthdayInvalid(t.birthday)||c.LightInvalid(t)}))){t.next=6;break}return t.abrupt("return");case 6:(0,m.N5)(e,(function(){p.fn.success("\u6210\u529f","\u5132\u5b58\u7bc4\u672c",3e3)}),(function(t){p.fn.error("\u932f\u8aa4","\u5132\u5b58\u7bc4\u672c",3e3)}));case 7:case"end":return t.stop()}}),t)}))),c.LoadTemplate=function(){(0,m._x)((function(t){c.setState({data:t,num:t.length}),p.fn.success("\u6210\u529f","\u8f09\u5165\u7bc4\u672c",3e3)}),(function(t){if("nodata"===t)p.fn.error("\u6c92\u6709\u8cc7\u6599","\u8f09\u5165\u7bc4\u672c",3e3)}))},c.NumChange=function(t){c.setState({num:t.target.value});for(var e=[],n=c.state.data.length;n<t.target.value;n++)e.push({name:"",birthday:"",light1:!1,light2:!1});c.setState({data:c.state.data.concat(e)})},c.DeleteRowData=function(){var t=(0,r.Z)((0,a.Z)().mark((function t(e){var n,r;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=parseInt(e.nativeEvent.target.getAttribute("data-key")),r=c.state.data.slice(0,n).concat(c.state.data.slice(n+1,c.state.data.length)),t.next=4,c.setState({data:r,num:r.length});case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),c.Certain=function(){var t=(0,r.Z)((0,a.Z)().mark((function t(e){var n;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.preventDefault(),e.stopPropagation(),t.next=4,c.setState({validated:!0});case 4:if(n=c.state.data.slice(0,c.state.num),!n.some((function(t){return c.NameInvalid(t.name)||c.BirthdayInvalid(t.birthday)||c.LightInvalid(t)}))){t.next=8;break}return t.abrupt("return");case 8:(0,m.gk)(c.props.id,n,(function(){p.fn.success("\u6210\u529f","\u9001\u51fa\u8cc7\u6599",3e3)}),(function(){p.fn.error("\u932f\u8aa4","\u9001\u51fa\u8cc7\u6599",3e3)}));case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),c.state={info:null,num:1,validated:!1,template:{name:"",birthday:"",light1:!1,light2:!1},data:[{name:"",birthday:"",light1:!1,light2:!1}],isAdmin:"true"===localStorage.getItem("isAdmin"),isSuperAdmin:"true"===localStorage.getItem("isSuperAdmin")},c}return(0,c.Z)(n,[{key:"componentDidMount",value:function(){var t=this;(0,m.Os)(this.props.id,(function(e){(0,m.tf)()>e.date&&!t.state.isAdmin&&!t.state.isSuperAdmin&&t.props.navigate("/john"),t.setState({info:e})})),(0,m._k)(this.props.id,(function(e){t.setState({data:e,num:e.length})}),(function(t){console.log(t)}))}},{key:"convertDate",value:function(){var t=new Date(this.state.info.date);return"".concat(t.getFullYear(),"\u5e74").concat((t.getMonth()+1).toString().padStart(2,"0"),"\u6708").concat(t.getDate(),"\u65e5")}},{key:"SelectOption",value:function(){var t=10;return(this.state.isAdmin||this.state.isSuperAdmin)&&(t=100),Array.from(Array(t).keys()).map((function(t){return(0,g.jsx)("option",{value:t+1,children:t+1},t+1)}))}},{key:"ValueChange",value:function(t,e){var n=e.target.getAttribute("data-key"),a=this.state.data;a[n][t]=e.target.value,this.setState({data:a})}},{key:"CheckBoxValueChange",value:function(t,e){var n=e.target.getAttribute("data-key"),a=this.state.data;a[n][t]=!a[n][t],this.setState({data:a})}},{key:"NameInvalid",value:function(t){return this.state.validated&&(t.length<2||t.length>6)}},{key:"BirthdayInvalid",value:function(t){var e=new Date,n=new Date(t);return this.state.validated&&(""===t||n.getTime()>=e.getTime())}},{key:"LightInvalid",value:function(t){return this.state.validated&&!t.light1&&!t.light2}},{key:"dyform",value:function(){for(var t=this,e=[],n=0;n<this.state.num;n++)e.push((0,g.jsxs)("div",{className:"mb-5 row d-flex",children:[(0,g.jsxs)(h.Z.Group,{className:"position-relative justify-content-center align-items-center d-flex mb-5 mb-md-0",as:f.Z,md:"4",controlId:"name".concat(n),children:[(0,g.jsx)(h.Z.Control,{required:!0,type:"string","data-key":n,placeholder:"\u8acb\u8f38\u5165\u59d3\u540d",value:this.state.data[n].name,onChange:function(e){return t.ValueChange("name",e)},isInvalid:this.NameInvalid(this.state.data[n].name)}),(0,g.jsx)(h.Z.Control.Feedback,{className:"text-nowrap",style:{top:"calc(100% + 5px)",left:"12px"},type:"invalid",tooltip:!0,children:""===this.state.data[n].name?"\u5fc5\u586b":"\u5b57\u6578\u5fc5\u9808\u4ecb\u65bc2\u52306\u4e4b\u9593"})]}),(0,g.jsxs)(h.Z.Group,{className:"position-relative justify-content-center align-items-center d-flex mb-5 mb-md-0",as:f.Z,md:"4",controlId:"name".concat(n),children:[(0,g.jsx)("label",{className:"text-nowrap col-4 col-md-5",children:"\u51fa\u751f\u5e74\u6708\u65e5"}),(0,g.jsx)(h.Z.Control,{required:!0,type:"date","data-key":n,placeholder:"\u8acb\u9078\u64c7\u51fa\u751f\u5e74\u6708\u65e5",value:this.state.data[n].birthday,onChange:function(e){return t.ValueChange("birthday",e)},isInvalid:this.BirthdayInvalid(this.state.data[n].birthday)}),(0,g.jsx)(h.Z.Control.Feedback,{className:"text-nowrap",style:{top:"calc(100% + 5px)",left:"12px"},type:"invalid",tooltip:!0,children:""===this.state.data[n].birthday?"\u5fc5\u586b":"\u8acb\u9078\u64c7\u6b63\u78ba\u51fa\u751f\u5e74\u6708\u65e5\u683c\u5f0f"})]}),(0,g.jsxs)("div",{className:"d-flex mb-5 mb-md-0 col-md-4 align-items-center",children:[(0,g.jsx)(h.Z.Group,{as:f.Z,md:"5",controlId:"light1".concat(n),children:(0,g.jsxs)(h.Z.Check,{className:"position-relative",children:[(0,g.jsx)(h.Z.Check.Input,{type:"checkbox","data-key":n,checked:this.state.data[n].light1||!1,isInvalid:this.LightInvalid(this.state.data[n]),onChange:function(e){return t.CheckBoxValueChange("light1",e)}}),(0,g.jsx)(h.Z.Check.Label,{children:"\u592a\u6b72\u71c8"}),(0,g.jsx)(h.Z.Control.Feedback,{className:"text-nowrap",style:{top:"calc(100% + 5px)",left:"0"},type:"invalid",tooltip:!0,children:"\u5fc5\u90781\u500b"})]})}),(0,g.jsx)(h.Z.Group,{as:f.Z,md:"5",controlId:"light2".concat(n),children:(0,g.jsxs)(h.Z.Check,{children:[(0,g.jsx)(h.Z.Check.Input,{type:"checkbox","data-key":n,checked:this.state.data[n].light2||!1,isInvalid:this.LightInvalid(this.state.data[n]),onChange:function(e){return t.CheckBoxValueChange("light2",e)}}),(0,g.jsx)(h.Z.Check.Label,{children:"\u5149\u660e\u71c8"})]})}),(0,g.jsx)("button",{className:"border-0 bg-transparent",onClick:this.DeleteRowData,disabled:1===this.state.num,children:(0,g.jsx)("i",{"data-key":n,className:"bi bi-dash-circle col-md-2"})})]}),(0,g.jsx)("hr",{className:"d-block d-sm-none"})]},n));return e}},{key:"render",value:function(){return this.state.info?(0,g.jsx)(h.Z,{noValidate:!0,onSubmit:this.Certain,children:(0,g.jsx)("div",{className:"container",children:(0,g.jsxs)("div",{className:"mx-auto shadow rounded mt-5 mb-5",style:{maxWidth:"900px",width:"100%",padding:"40px 30px"},children:[(0,g.jsx)("p",{className:"fs-2 text-center",children:"\u8f38\u5165\u9ede\u71c8\u8cc7\u6599"}),(0,g.jsxs)("div",{className:"row mb-3",children:[(0,g.jsxs)("div",{className:"col-md-4 my-2 align-self-center",children:["\u540d\u7a31:",this.state.info.name]}),(0,g.jsxs)("div",{className:"col-md-5 my-2 align-self-center",children:["\u622a\u6b62\u65e5\u671f:",this.convertDate()]}),(0,g.jsxs)("div",{className:"col-md-3 my-2 align-self-center",children:["\u4eba\u6578:",(0,g.jsx)("select",{className:"form-select w-auto ms-3 d-inline-block",value:this.state.num,onChange:this.NumChange,children:this.SelectOption()})]}),(0,g.jsxs)("div",{className:"col-md-12 my-2 align-self-center",children:[(0,g.jsx)(v.Z,{className:"btn btn-primary me-3",onClick:this.SaveTemplate,children:"\u5132\u5b58\u7bc4\u672c"}),(0,g.jsx)(v.Z,{className:"btn btn-primary",onClick:this.LoadTemplate,children:"\u8f09\u5165\u7bc4\u672c"})]})]}),(0,g.jsx)("hr",{className:"mb-5"}),this.dyform(),(0,g.jsx)("div",{className:"row mt-4",children:(0,g.jsxs)("div",{className:"text-center",children:[(0,g.jsx)(v.Z,{className:"me-3 px-5",type:"submit",children:"\u78ba\u8a8d"}),(0,g.jsx)(l.rU,{className:"btn btn-danger px-5",to:"./..",children:"\u53d6\u6d88"})]})})]})})}):(0,g.jsx)(x.g,{})}}]),n}(u.Component);function Z(){var t=(0,d.UO)().id,e=(0,d.s0)();return(0,g.jsx)(y,{id:t,navigate:e})}},6115:function(t,e,n){n.d(e,{C:function(){return s},n:function(){return c}});var a=n(9033),r=n(408),i=(0,a.v0)(),c=function(){return new Promise((function(t){if(i.currentUser)t(!0);else var e=(0,a.v0)().onAuthStateChanged((function(n){e(),t(!!n)}))}))},s=function(t){return new Promise((function(e,n){(0,r.jM)(t,(function(t){e(t)}),(function(t){n(t)}),{onlyOnce:!0})}))}},2822:function(t,e,n){n.d(e,{CK:function(){return g},Ce:function(){return m},EJ:function(){return x},N5:function(){return C},NI:function(){return p},Ne:function(){return j},Os:function(){return Z},Wo:function(){return d},Z9:function(){return f},_k:function(){return k},_x:function(){return w},av:function(){return v},gk:function(){return b},tf:function(){return N},u$:function(){return y},xJ:function(){return h}});var a=n(1413),r=n(4165),i=n(5861),c=n(408),s=n(6115),o=n(9033),u=(0,c.N8)(),l=(0,o.v0)(),d=function(){var t=(0,i.Z)((0,r.Z)().mark((function t(e){var n,a,i;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={},a={},i={},t.next=5,(0,s.C)((0,c.iH)(u,"isActive")).then((function(t){t.exists()&&"object"===typeof t.val()&&(n=t.val())}));case 5:return t.next=7,(0,s.C)((0,c.iH)(u,"isAdmin")).then((function(t){t.exists()&&"object"===typeof t.val()&&(a=t.val())}));case 7:return t.next=9,(0,s.C)((0,c.iH)(u,"isSuperAdmin")).then((function(t){t.exists()&&"object"===typeof t.val()&&(i=t.val())}));case 9:return t.next=11,(0,s.C)((0,c.iH)(u,"users")).then((function(t){if(t.exists()){for(var r=t.val(),c=Object.keys(r),s=[],o=0;o<c.length;o++){var u=r[c[o]];if(!i[c[o]]&&!a[c[o]]){var l={Id:c[o],email:u.email||!1,isActive:n[c[o]]||!1,isAdmin:a[c[o]]||!1,isChange:!1};s.push(l)}}e(s)}else e([])})).catch((function(t){console.error(t)}));case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),h=function(){var t=(0,i.Z)((0,r.Z)().mark((function t(e){var n,a,i;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={},a={},i={},t.next=5,(0,s.C)((0,c.iH)(u,"isActive")).then((function(t){t.exists()&&"object"===typeof t.val()&&(n=t.val())}));case 5:return t.next=7,(0,s.C)((0,c.iH)(u,"isAdmin")).then((function(t){t.exists()&&"object"===typeof t.val()&&(a=t.val())}));case 7:return t.next=9,(0,s.C)((0,c.iH)(u,"isSuperAdmin")).then((function(t){t.exists()&&"object"===typeof t.val()&&(i=t.val())}));case 9:return t.next=11,(0,s.C)((0,c.iH)(u,"users")).then((function(t){if(t.exists()){for(var r=t.val(),c=Object.keys(r),s=[],o=0;o<c.length;o++){var u=r[c[o]];if(!i[c[o]]){var l={Id:c[o],email:u.email||!1,isActive:n[c[o]]||!1,isAdmin:a[c[o]]||!1,isChange:!1};s.push(l)}}e(s)}else e([])})).catch((function(t){console.error(t)}));case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),f=function(t,e,n){try{for(var a=0;a<t.length;a++){var r=t[a];r.isChange&&(0,c.t8)((0,c.iH)(u,"isActive/".concat(r.Id)),r.isActive)}e()}catch(i){n(i)}},v=function(t,e,n){try{for(var a=0;a<t.length;a++){var r=t[a];r.isChange&&((0,c.t8)((0,c.iH)(u,"isActive/".concat(r.Id)),r.isActive),(0,c.t8)((0,c.iH)(u,"isAdmin/".concat(r.Id)),r.isAdmin))}e()}catch(i){n(i)}},m=function(t,e,n,r){(0,c.t8)((0,c.iH)(u,"activity/".concat(t)),(0,a.Z)((0,a.Z)({},e),{},{time:(new Date).getTime()})).then((function(t){return n()})).catch((function(t){return r()}))},p=function(t,e,n,r){(0,c.t8)((0,c.iH)(u,"activity/".concat(t)),(0,a.Z)((0,a.Z)({},e),{},{time:(new Date).getTime()})).then((function(t){return n()})).catch(r)},x=function(t){(0,c.U2)((0,c.iH)(u,"activity/")).then((function(e){e.exists()?t(Object.keys(e.val()).length):t(0)})).catch((function(t){console.error(t)}))},g=function(){var t=(0,i.Z)((0,r.Z)().mark((function t(e){return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,s.n)();case 2:(0,s.C)((0,c.iH)(u,"activity")).then((function(t){if(t.exists()){var n=t.val().map((function(t,e){return(0,a.Z)((0,a.Z)({},t),{},{date:I(t.date),id:e})})).filter((function(t){return new Date(N())<=new Date(t.date)})).sort((function(t,e){return t.date<e.date?1:-1}));e(n)}else e([])})).catch((function(t){console.error(t)}));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),y=function(){var t=(0,i.Z)((0,r.Z)().mark((function t(e){return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,s.n)();case 2:(0,s.C)((0,c.iH)(u,"activity")).then((function(t){if(t.exists()){var n=t.val().map((function(t,e){return(0,a.Z)((0,a.Z)({},t),{},{date:I(t.date),id:e})}));e(n.sort((function(t,e){return t.date<e.date?1:-1})))}else e([])})).catch((function(t){console.error(t)}));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Z=function(t,e){(0,s.C)((0,c.iH)(u,"activity/".concat(t))).then((function(t){if(t.exists()){var n=t.val();e({name:n.name,date:new Date(n.date).toISOString().split("T")[0]})}else e([])})).catch((function(t){console.error(t)}))},k=function(){var t=(0,i.Z)((0,r.Z)().mark((function t(e,n,a){var i;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,s.n)();case 2:i=l.currentUser,(0,s.C)((0,c.iH)(u,"join/".concat(e,"/").concat(i.uid))).then((function(t){t.exists()?n(t.val()):n([{name:"",birthday:"",light1:!1,light2:!1}])})).catch((function(t){a(t)}));case 4:case"end":return t.stop()}}),t)})));return function(e,n,a){return t.apply(this,arguments)}}(),b=function(t,e,n,a){var r=l.currentUser;(0,c.t8)((0,c.iH)(u,"join/".concat(t,"/").concat(r.uid)),e).then((function(t){return n()})).catch((function(t){return a()}))},j=function(){var t=(0,i.Z)((0,r.Z)().mark((function t(e,n,a){return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,s.n)();case 2:(0,s.C)((0,c.iH)(u,"join/".concat(e))).then((function(t){if(t.exists()){for(var e=t.val(),a=Object.keys(e),r=[],i=0;i<a.length;i++)r=r.concat(e[a[i]]);n(r)}else n([])})).catch((function(t){a(t)}));case 3:case"end":return t.stop()}}),t)})));return function(e,n,a){return t.apply(this,arguments)}}(),C=function(){var t=(0,i.Z)((0,r.Z)().mark((function t(e,n,a){var i;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,s.n)();case 2:i=l.currentUser,(0,c.t8)((0,c.iH)(u,"template/".concat(i.uid)),e).then((function(t){return n()})).catch((function(t){return a()}));case 4:case"end":return t.stop()}}),t)})));return function(e,n,a){return t.apply(this,arguments)}}(),w=function(){var t=(0,i.Z)((0,r.Z)().mark((function t(e,n){var a;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,s.n)();case 2:a=l.currentUser,(0,s.C)((0,c.iH)(u,"template/".concat(a.uid))).then((function(t){if(!t.exists())throw new Error("nodata");e(t.val())})).catch((function(t){n(t)}));case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),N=function(){var t=new Date;return"".concat(t.getFullYear(),"-").concat((t.getMonth()+1).toString().padStart(2,"0"),"-").concat(t.getDate())},I=function(t){return new Date(t).toISOString().split("T")[0]}}}]);
//# sourceMappingURL=907.38474928.chunk.js.map