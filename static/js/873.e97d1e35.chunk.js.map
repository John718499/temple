{"version":3,"file":"static/js/873.e97d1e35.chunk.js","mappings":"0PAMMA,EAAAA,SAAAA,IAAAA,EAAAA,EAAAA,GAAAA,EAAAA,GAAAA,IAAAA,GAAAA,EAAAA,EAAAA,GAAAA,GAEF,WAAYC,GAAO,IAAD,yBACd,cAAMA,IA2DVC,WAAW,SAACC,GACR,EAAKC,SAAS,CAACD,KAAKA,EAAKE,OAAOC,OACnC,EA9DiB,EAgElBC,WAAW,SAACC,GACR,EAAKJ,SAAS,CAACI,KAAKA,EAAKH,OAAOC,OACnC,EAlEiB,EAoElBG,QApEkB,yCAoER,WAAOC,GAAP,6EACNA,EAAMC,iBACND,EAAME,kBAFA,SAIA,EAAKR,SAAS,CAACS,WAAU,IAJzB,WAMS,CACX,EAAKC,cACL,EAAKC,eAGIC,MAAK,SAAAC,GAAO,OAAEA,CAAF,IAXnB,kDAaNC,EAAAA,EAAAA,KAAc,SAACC,GACX,IAAIC,EAAGD,GACPE,EAAAA,EAAAA,IACID,EACA,CACIjB,KAAK,EAAKmB,MAAMnB,KAChBK,KAAK,IAAIe,KAAK,EAAKD,MAAMd,MAAMgB,YAEnC,WACIC,EAAAA,GAAAA,QAA4B,eAAM,2BAAO,IAC5C,IACD,WACIA,EAAAA,GAAAA,MAA0B,eAAM,2BAAO,IAC1C,GAER,IA5BK,2CApEQ,sDAEd,EAAKH,MAAM,CACPnB,KAAK,GACLU,WAAU,EACVL,MAAKkB,EAAAA,EAAAA,OALK,CAOjB,CAmDA,OAnDA,mCAED,WACI,OAAOC,KAAKL,MAAMT,YAAcc,KAAKL,MAAMnB,KAAKyB,OAAO,GAAKD,KAAKL,MAAMnB,KAAKyB,OAAO,GACtF,4BAED,WACI,IAAMC,EAAM,IAAIN,MAAKG,EAAAA,EAAAA,OACfI,EAAU,IAAIP,KAAKI,KAAKL,MAAMd,MACpC,OAAOmB,KAAKL,MAAMT,WAAegB,GAASC,CAC7C,uBAED,WACI,OACI,SAAC,IAAD,CAAMC,YAAU,EAACC,SAAUL,KAAKlB,QAAhC,UACI,gBAAKwB,UAAU,YAAf,UACI,iBAAKA,UAAU,mCAAmCC,MAAO,CAAEC,SAAU,QAASC,MAAO,OAAQC,QAAS,aAAtG,WACI,cAAGJ,UAAU,mBAAb,mDACA,iBAAKA,UAAU,MAAf,WACI,UAAC,UAAD,CAAYA,UAAU,0EAA0EK,GAAIC,EAAAA,EAAKC,GAAG,KAAKC,UAAU,OAA3H,WACI,SAAC,UAAD,CAAYR,UAAU,0CAAtB,2BACA,SAAC,YAAD,CACIS,UAAQ,EACRC,KAAK,SACLC,YAAY,iCACZtC,MAAOqB,KAAKL,MAAMnB,KAClB0C,SAAUlB,KAAKzB,WACf4C,UAAWnB,KAAKb,iBAEpB,SAAC,qBAAD,CAAuBmB,UAAU,cAAcC,MAAO,CAACa,IAAI,mBAAmBC,KAAK,QAASL,KAAK,UAAUM,SAAO,EAAlH,SAAsI,KAAlBtB,KAAKL,MAAMnB,KAAU,eAAK,kEAElJ,UAAC,UAAD,CAAY8B,UAAU,0EAA0EK,GAAIC,EAAAA,EAAKC,GAAG,KAAKC,UAAU,OAA3H,WACI,SAAC,UAAD,CAAYR,UAAU,0CAAtB,uCACA,SAAC,YAAD,CACIS,UAAQ,EACRC,KAAK,OACLrC,MAAOqB,KAAKL,MAAMd,KAClBqC,SAAUlB,KAAKpB,WACfuC,UAAWnB,KAAKZ,iBAEpB,SAAC,qBAAD,CAAuBkB,UAAU,cAAcC,MAAO,CAACa,IAAI,mBAAmBC,KAAK,QAASL,KAAK,UAAUM,SAAO,EAAlH,SAAsI,KAAlBtB,KAAKL,MAAMd,KAAU,eAAK,wEAGtJ,iBAAKyB,UAAU,yBAAf,WACI,SAAC,IAAD,CAAQA,UAAU,OAAOU,KAAK,SAA9B,2BACA,SAAC,KAAD,CAAMV,UAAU,iBAAiBiB,GAAI,UAArC,mCAMvB,OA5DClD,CAAemD,EAAAA,WAsGrB,W,qGCzGMC,GAAOC,EAAAA,EAAAA,MAEAC,EAAc,WACvB,OAAO,IAAIC,SAAQ,SAAAC,GACf,GAAIJ,EAAKK,YACLD,GAAQ,QAER,IAAME,GAAcL,EAAAA,EAAAA,MAAUM,oBAAmB,SAAUC,GACvDF,IAEIF,IADAI,EAKP,GAER,GACJ,EAEYC,EAAW,SAACC,GACrB,OAAO,IAAIP,SAAQ,SAACC,EAASO,IASzBC,EAAAA,EAAAA,IAAQF,GAJR,SAAgBG,GACZT,EAAQS,EACX,IAND,SAAiBC,GACbH,EAAOG,EACV,GAM6B,CAAEC,UAAU,GAC7C,GACJ,C,+dClBKC,GAAKC,EAAAA,EAAAA,MACLjB,GAAOC,EAAAA,EAAAA,MAEAiB,EAAc,yCAAG,WAAOC,GAAP,uFACxBC,EAAY,CAAC,EACbC,EAAW,CAAC,EACZC,EAAgB,CAAC,EAHO,UAKtBb,EAAAA,EAAAA,IAASC,EAAAA,EAAAA,IAAIM,EAAI,aAAaO,MAAK,SAACC,GACpCA,EAASC,UAAwC,kBAApBD,EAASE,QACxCN,EAAYI,EAASE,MAExB,IAT2B,wBAWtBjB,EAAAA,EAAAA,IAASC,EAAAA,EAAAA,IAAIM,EAAI,YAAYO,MAAK,SAACC,GACnCA,EAASC,UAAwC,kBAApBD,EAASE,QACxCL,EAAWG,EAASE,MAEvB,IAf2B,wBAiBtBjB,EAAAA,EAAAA,IAASC,EAAAA,EAAAA,IAAIM,EAAI,iBAAiBO,MAAK,SAACC,GACxCA,EAASC,UAAwC,kBAApBD,EAASE,QACxCJ,EAAgBE,EAASE,MAE5B,IArB2B,yBAuBtBjB,EAAAA,EAAAA,IAASC,EAAAA,EAAAA,IAAIM,EAAD,UAAeO,MAAK,SAACC,GACrC,GAAIA,EAASC,SAAU,CAKrB,IAJA,IAAME,EAAWH,EAASE,MACpBE,EAAUC,OAAOC,KAAKH,GACxBI,EAAW,GAENC,EAAI,EAAGA,EAAIJ,EAAQpD,OAAQwD,IAAK,CAEvC,IAAMC,EAAUN,EAASC,EAAQI,IACjC,IAAIV,EAAcM,EAAQI,MAAOX,EAASO,EAAQI,IAAlD,CAEA,IAAIE,EAAU,CACZC,GAAIP,EAAQI,GACZI,MAAOH,EAAQG,QAAS,EACxBC,SAAUjB,EAAUQ,EAAQI,MAAO,EACnCM,QAASjB,EAASO,EAAQI,MAAO,EACjCO,UAAU,GAGZR,EAASS,KAAKN,EAViD,CAWhE,CAEDf,EAASY,EACV,MACCZ,EAAS,GAEZ,IAAEsB,OAAM,SAAC3B,GACR4B,QAAQ5B,MAAMA,EACf,IAnD2B,4CAAH,sDAsDd6B,EAAO,yCAAG,WAAOxB,GAAP,uFACjBC,EAAY,CAAC,EACbC,EAAW,CAAC,EACZC,EAAgB,CAAC,EAHA,UAKfb,EAAAA,EAAAA,IAASC,EAAAA,EAAAA,IAAIM,EAAI,aAAaO,MAAK,SAACC,GACpCA,EAASC,UAAwC,kBAApBD,EAASE,QACxCN,EAAYI,EAASE,MAExB,IAToB,wBAWfjB,EAAAA,EAAAA,IAASC,EAAAA,EAAAA,IAAIM,EAAI,YAAYO,MAAK,SAACC,GACnCA,EAASC,UAAwC,kBAApBD,EAASE,QACxCL,EAAWG,EAASE,MAEvB,IAfoB,wBAiBfjB,EAAAA,EAAAA,IAASC,EAAAA,EAAAA,IAAIM,EAAI,iBAAiBO,MAAK,SAACC,GACxCA,EAASC,UAAwC,kBAApBD,EAASE,QACxCJ,EAAgBE,EAASE,MAE5B,IArBoB,yBAuBfjB,EAAAA,EAAAA,IAASC,EAAAA,EAAAA,IAAIM,EAAI,UAAUO,MAAK,SAACC,GACrC,GAAIA,EAASC,SAAU,CAKrB,IAJA,IAAME,EAAWH,EAASE,MACpBE,EAAUC,OAAOC,KAAKH,GACxBI,EAAW,GAENC,EAAI,EAAGA,EAAIJ,EAAQpD,OAAQwD,IAAK,CAEvC,IAAMC,EAAUN,EAASC,EAAQI,IACjC,IAAIV,EAAcM,EAAQI,IAA1B,CAEA,IAAIE,EAAU,CACZC,GAAIP,EAAQI,GACZI,MAAOH,EAAQG,QAAS,EACxBC,SAAUjB,EAAUQ,EAAQI,MAAO,EACnCM,QAASjB,EAASO,EAAQI,MAAO,EACjCO,UAAU,GAGZR,EAASS,KAAKN,EAVyB,CAWxC,CAEDf,EAASY,EACV,MACCZ,EAAS,GAEZ,IAAEsB,OAAM,SAAC3B,GACR4B,QAAQ5B,MAAMA,EACf,IAnDoB,4CAAH,sDAsDP8B,EAA2B,SAACC,EAAO1B,EAAU2B,GACxD,IACE,IAAK,IAAId,EAAI,EAAGA,EAAIa,EAAMrE,OAAQwD,IAAK,CACrC,IAAMC,EAAUY,EAAMb,GAClBC,EAAQM,WAAUQ,EAAAA,EAAAA,KAAIrC,EAAAA,EAAAA,IAAIM,EAAD,mBAAiBiB,EAAQE,KAAOF,EAAQI,SACtE,CACDlB,GAGD,CAFC,MAAOL,GACPgC,EAAchC,EACf,CACF,EAEYkC,EAAoB,SAACH,EAAO1B,EAAU2B,GACjD,IACE,IAAK,IAAId,EAAI,EAAGA,EAAIa,EAAMrE,OAAQwD,IAAK,CACrC,IAAMC,EAAUY,EAAMb,GAClBC,EAAQM,YACVQ,EAAAA,EAAAA,KAAIrC,EAAAA,EAAAA,IAAIM,EAAD,mBAAiBiB,EAAQE,KAAOF,EAAQI,WAC/CU,EAAAA,EAAAA,KAAIrC,EAAAA,EAAAA,IAAIM,EAAD,kBAAgBiB,EAAQE,KAAOF,EAAQK,SAEjD,CACDnB,GAGD,CAFC,MAAOL,GACPgC,EAAchC,EACf,CACF,EAEY7C,EAAc,SAACD,EAAIiF,EAAM9B,EAAU2B,IAC9CC,EAAAA,EAAAA,KAAIrC,EAAAA,EAAAA,IAAIM,EAAD,mBAAiBhD,KAArB,QAAC,UAA+BiF,GAAhC,IAAqCC,MAAK,IAAI/E,MAAOC,aAAYmD,MAAK,SAAA4B,GAAC,OAAIhC,GAAJ,IAAgBsB,OAAM,SAAAU,GAAC,OAAIL,GAAJ,GAClG,EAEYM,EAAe,SAACpF,EAAIiF,EAAM9B,EAAU2B,IAC/CC,EAAAA,EAAAA,KAAIrC,EAAAA,EAAAA,IAAIM,EAAD,mBAAiBhD,KAArB,QAAC,UAA+BiF,GAAhC,IAAqCC,MAAK,IAAI/E,MAAOC,aAAYmD,MAAK,SAAA4B,GAAC,OAAIhC,GAAJ,IAAgBsB,MAAMK,EACjG,EAEYhF,EAAgB,SAACqD,IAC5BkC,EAAAA,EAAAA,KAAI3C,EAAAA,EAAAA,IAAIM,EAAD,cAAmBO,MAAK,SAACC,GAC1BA,EAASC,SACXN,EAASU,OAAOC,KAAKN,EAASE,OAAOlD,QAErC2C,EAAS,EAEZ,IAAEsB,OAAM,SAAC3B,GACR4B,QAAQ5B,MAAMA,EACf,GACF,EAEYwC,EAAY,yCAAG,WAAOnC,GAAP,uFACpBjB,EAAAA,EAAAA,KADoB,QAE1BO,EAAAA,EAAAA,IAASC,EAAAA,EAAAA,IAAIM,EAAD,aAAkBO,MAAK,SAACC,GAClC,GAAIA,EAASC,SAAU,CACrB,IACM8B,EADa/B,EAASE,MAAM8B,KAAI,SAACC,EAAGC,GAAJ,eAAC,UAAmBD,GAApB,IAAuBrG,KAAMuG,EAAgBF,EAAErG,MAAOY,GAAI0F,GAA1D,IACJE,QAAO,SAAAH,GAAC,OAAI,IAAItF,KAAKG,MAAY,IAAIH,KAAKsF,EAAErG,KAApC,IAA2CyG,MAAK,SAACC,EAAGC,GAAJ,OAAUD,EAAE1G,KAAO2G,EAAE3G,KAAO,GAAK,CAAjC,IAC1F+D,EAASoC,EACV,MACCpC,EAAS,GAEZ,IAAEsB,OAAM,SAAC3B,GACR4B,QAAQ5B,MAAMA,EACf,IAZyB,2CAAH,sDAeZkD,EAAW,yCAAG,WAAO7C,GAAP,uFACnBjB,EAAAA,EAAAA,KADmB,QAEzBO,EAAAA,EAAAA,IAASC,EAAAA,EAAAA,IAAIM,EAAD,aAAkBO,MAAK,SAACC,GAClC,GAAIA,EAASC,SAAU,CACrB,IAAMwC,EAAazC,EAASE,MAAM8B,KAAI,SAACC,EAAGC,GAAJ,eAAC,UAAmBD,GAApB,IAAsBrG,KAAMuG,EAAgBF,EAAErG,MAAOY,GAAI0F,GAAzD,IACtCvC,EAAS8C,EAAWJ,MAAK,SAACC,EAAGC,GAAJ,OAAUD,EAAE1G,KAAO2G,EAAE3G,KAAO,GAAK,CAAjC,IAC1B,MACC+D,EAAS,GAEZ,IAAEsB,OAAM,SAAC3B,GACR4B,QAAQ5B,MAAMA,EACf,IAXwB,2CAAH,sDAcXoD,EAAe,SAAClG,EAAImD,IAC/BV,EAAAA,EAAAA,IAASC,EAAAA,EAAAA,IAAIM,EAAD,mBAAiBhD,KAAOuD,MAAK,SAACC,GACxC,GAAIA,EAASC,SAAU,CACrB,IAAMwB,EAAKzB,EAASE,MACpBP,EAAS,CACPpE,KAAKkG,EAAKlG,KACVK,KAAK,IAAIe,KAAK8E,EAAK7F,MAAM+G,cAAcC,MAAM,KAAK,IAErD,MACCjD,EAAS,GAEZ,IAAEsB,OAAM,SAAC3B,GACR4B,QAAQ5B,MAAMA,EACf,GACF,EAEYuD,EAAO,yCAAG,WAAOrG,EAAImD,EAAU2B,GAArB,6FACf5C,EAAAA,EAAAA,KADe,OAGfG,EAAcL,EAAKK,aACzBI,EAAAA,EAAAA,IAASC,EAAAA,EAAAA,IAAIM,EAAD,eAAahD,EAAb,YAAmBqC,EAAYiE,OAAQ/C,MAAK,SAACC,GACnDA,EAASC,SACXN,EAASK,EAASE,OAElBP,EACE,CAAC,CACCpE,KAAM,GACNwH,SAAU,GACVC,QAAQ,EACRC,QAAQ,IAIf,IAAEhC,OAAM,SAAC3B,GACRgC,EAAchC,EACf,IAnBoB,2CAAH,0DAsBP4D,EAAW,SAAC1G,EAAIiF,EAAM9B,EAAU2B,GAC3C,IAAMzC,EAAcL,EAAKK,aACzB0C,EAAAA,EAAAA,KAAIrC,EAAAA,EAAAA,IAAIM,EAAD,eAAahD,EAAb,YAAmBqC,EAAYiE,MAAQrB,GAAM1B,MAAK,SAAA4B,GAAC,OAAIhC,GAAJ,IAAgBsB,OAAM,SAAAU,GAAC,OAAIL,GAAJ,GAClF,EAGY6B,EAAU,yCAAG,WAAO3G,EAAImD,EAAU2B,GAArB,uFAClB5C,EAAAA,EAAAA,KADkB,QAGxBO,EAAAA,EAAAA,IAASC,EAAAA,EAAAA,IAAIM,EAAD,eAAahD,KAAOuD,MAAK,SAACC,GACpC,GAAIA,EAASC,SAAU,CAKrB,IAJA,IAAMmD,EAAapD,EAASE,MACtBmD,EAAUhD,OAAOC,KAAK8C,GAExBE,EAAa,GACR9C,EAAI,EAAGA,EAAI6C,EAAQrG,OAAQwD,IAClC8C,EAAaA,EAAWC,OAAOH,EAAWC,EAAQ7C,KAGpDb,EAAS2D,EACV,MACC3D,EACE,GAGL,IAAEsB,OAAM,SAAC3B,GACRgC,EAAchC,EACf,IArBuB,2CAAH,0DAyBVkE,EAAY,yCAAG,WAAO/B,EAAM9B,EAAU2B,GAAvB,6FACpB5C,EAAAA,EAAAA,KADoB,OAEpBG,EAAcL,EAAKK,aACzB0C,EAAAA,EAAAA,KAAIrC,EAAAA,EAAAA,IAAIM,EAAD,mBAAiBX,EAAYiE,MAAQrB,GAAM1B,MAAK,SAAA4B,GAAC,OAAIhC,GAAJ,IAAgBsB,OAAM,SAAAU,GAAC,OAAIL,GAAJ,IAHrD,2CAAH,0DAMZmC,EAAY,yCAAG,WAAO9D,EAAU2B,GAAjB,6FACpB5C,EAAAA,EAAAA,KADoB,OAEpBG,EAAcL,EAAKK,aACzBI,EAAAA,EAAAA,IAASC,EAAAA,EAAAA,IAAIM,EAAD,mBAAiBX,EAAYiE,OAAQ/C,MAAK,SAACC,GACrD,IAAIA,EAASC,SAGX,MAAM,IAAIyD,MAAM,UAFhB/D,EAASK,EAASE,MAIrB,IAAEe,OAAM,SAAC3B,GACRgC,EAAchC,EACf,IAXyB,2CAAH,wDAcZxC,EAAQ,WACnB,IAAIG,EAAQ,IAAIN,KAChB,MAAM,GAAN,OAAUM,EAAM0G,cAAhB,aAAkC1G,EAAM2G,WAAa,GAAGC,WAAWC,SAAS,EAAG,KAA/E,YAAuF7G,EAAM8G,UAC9F,EAEY5B,EAAkB,SAACT,GAC9B,OAAO,IAAI/E,KAAK+E,GAAMiB,cAAcC,MAAM,KAAK,EAChD,C","sources":["pages/create/create.js","services/firebase-async.js","services/user-service.js"],"sourcesContent":["import React from 'react';\r\nimport { Link } from \"react-router-dom\";\r\nimport { AddActivity, ActivityCount, Today } from '../../services/user-service';\r\nimport { Button, Form, Col } from 'react-bootstrap';\r\nimport { NotificationManager } from 'react-notifications';\r\n\r\nclass Create extends React.Component{\r\n    \r\n    constructor(props){\r\n        super(props);\r\n        this.state={\r\n            name:\"\",\r\n            validated:false,\r\n            date:Today(),\r\n        }\r\n    }\r\n\r\n    NameInvalid(){\r\n        return this.state.validated && (this.state.name.length<2 || this.state.name.length>12);\r\n    }\r\n\r\n    DateInvalid(){\r\n        const today=new Date(Today());\r\n        const inputDate=new Date(this.state.date);\r\n        return this.state.validated && ( today >= inputDate);\r\n    }\r\n\r\n    render(){\r\n        return (\r\n            <Form noValidate onSubmit={this.Certain}>\r\n                <div className=\"container\">\r\n                    <div className=\"mx-auto shadow rounded mt-5 mb-5\" style={{ maxWidth: '600px', width: '100%', padding: '40px 30px'}}>\r\n                        <p className=\"fs-2 text-center\">建立點燈表單</p>\r\n                        <div className=\"row\">\r\n                            <Form.Group className=\"position-relative justify-content-center align-items-center d-flex mb-5\" as={Col} md=\"12\" controlId=\"name\">\r\n                                <Form.Label className=\"text-nowrap align-self-center mb-0 me-3\">名稱</Form.Label>\r\n                                <Form.Control\r\n                                    required\r\n                                    type=\"string\"\r\n                                    placeholder=\"請輸入名稱\"\r\n                                    value={this.state.name}\r\n                                    onChange={this.NameChange}\r\n                                    isInvalid={this.NameInvalid()}\r\n                                />\r\n                                <Form.Control.Feedback className=\"text-nowrap\" style={{top:\"calc(100% + 5px)\",left:\"12px\"}} type=\"invalid\" tooltip>{this.state.name===\"\"?\"必填\":\"字數必須介於2到12之間\"}</Form.Control.Feedback>\r\n                            </Form.Group>\r\n                            <Form.Group className=\"position-relative justify-content-center align-items-center d-flex mb-5\" as={Col} md=\"12\" controlId=\"date\">\r\n                                <Form.Label className=\"text-nowrap align-self-center mb-0 me-3\">截止日期</Form.Label>\r\n                                <Form.Control\r\n                                    required\r\n                                    type=\"date\"\r\n                                    value={this.state.date}\r\n                                    onChange={this.DateChange}\r\n                                    isInvalid={this.DateInvalid()}\r\n                                />\r\n                                <Form.Control.Feedback className=\"text-nowrap\" style={{top:\"calc(100% + 5px)\",left:\"12px\"}} type=\"invalid\" tooltip>{this.state.date===\"\"?\"必填\":\"請選擇今天之後的日期\"}</Form.Control.Feedback>\r\n                            </Form.Group>\r\n                        </div>\r\n                        <div className=\"col-12 p-3 text-center\">\r\n                            <Button className=\"me-3\" type=\"submit\">確認</Button>\r\n                            <Link className=\"btn btn-danger\" to={\"../join\"}>取消</Link>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </Form>\r\n        )\r\n    }\r\n\r\n    NameChange=(name)=>{\r\n        this.setState({name:name.target.value})\r\n    }\r\n\r\n    DateChange=(date)=>{\r\n        this.setState({date:date.target.value})\r\n    }\r\n\r\n    Certain = async (event) => {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n\r\n        await this.setState({validated:true })\r\n        \r\n        const invalids=[\r\n            this.NameInvalid(),\r\n            this.DateInvalid(),\r\n        ]\r\n\r\n        if (invalids.some(invaild=>invaild)) return;\r\n\r\n        ActivityCount((result)=>{\r\n            let id=result;\r\n            AddActivity(\r\n                id,\r\n                {\r\n                    name:this.state.name,\r\n                    date:new Date(this.state.date).getTime(),\r\n                },\r\n                ()=>{\r\n                    NotificationManager.success('成功', '創建活動',3000);\r\n                },\r\n                ()=>{\r\n                    NotificationManager.error('錯誤', '創建活動',3000);\r\n                },\r\n            )\r\n        });\r\n    }\r\n}\r\n\r\nexport default Create;","import { getAuth } from \"firebase/auth\";\r\nimport { DatabaseReference,DataSnapshot,onValue } from 'firebase/database';\r\n\r\nconst auth = getAuth();\r\n\r\nexport const canActivate = () => {\r\n    return new Promise(resolve => {\r\n        if (auth.currentUser) {\r\n            resolve(true);\r\n        } else {\r\n            const unsubscribe = getAuth().onAuthStateChanged(function (user) {\r\n                unsubscribe();\r\n                if (user) {\r\n                    resolve(true);\r\n                } else {\r\n                    resolve(false);\r\n                }\r\n            });\r\n        }\r\n    });\r\n}\r\n\r\nexport const getAsync = (ref: DatabaseReference): Promise<DataSnapshot>=> {\r\n    return new Promise((resolve, reject) => {\r\n        function onError(error) {\r\n            reject(error);\r\n        } \r\n\r\n        function onData(snap) {\r\n            resolve(snap);\r\n        }\r\n  \r\n        onValue(ref, onData, onError, { onlyOnce: true });\r\n    });\r\n}","import {\r\n  getDatabase,\r\n  ref,\r\n  set,\r\n  get\r\n} from 'firebase/database';\r\nimport {\r\n  canActivate,\r\n  getAsync\r\n} from './firebase-async';\r\nimport {\r\n  getAuth\r\n} from \"firebase/auth\";\r\n\r\n\r\n\r\nconst db = getDatabase();\r\nconst auth = getAuth();\r\n\r\nexport const AllGeneralUser = async (callback) => {\r\n  let isActives = {};\r\n  let isAdmins = {};\r\n  let isSuperAdmins = {};\r\n\r\n  await getAsync(ref(db, \"isActive\")).then((snapshot) => {\r\n    if (snapshot.exists() && (typeof snapshot.val()) === \"object\") {\r\n      isActives = snapshot.val();\r\n    }\r\n  })\r\n\r\n  await getAsync(ref(db, \"isAdmin\")).then((snapshot) => {\r\n    if (snapshot.exists() && (typeof snapshot.val()) === \"object\") {\r\n      isAdmins = snapshot.val();\r\n    }\r\n  })\r\n\r\n  await getAsync(ref(db, \"isSuperAdmin\")).then((snapshot) => {\r\n    if (snapshot.exists() && (typeof snapshot.val()) === \"object\") {\r\n      isSuperAdmins = snapshot.val();\r\n    }\r\n  })\r\n\r\n  await getAsync(ref(db, `users`)).then((snapshot) => {\r\n    if (snapshot.exists()) {\r\n      const userData = snapshot.val();\r\n      const userIds = Object.keys(userData);\r\n      let userList = [];\r\n\r\n      for (let i = 0; i < userIds.length; i++) {\r\n\r\n        const oldData = userData[userIds[i]];\r\n        if (isSuperAdmins[userIds[i]] || isAdmins[userIds[i]]) continue;\r\n\r\n        let newData = {\r\n          Id: userIds[i],\r\n          email: oldData.email || false,\r\n          isActive: isActives[userIds[i]] || false,\r\n          isAdmin: isAdmins[userIds[i]] || false,\r\n          isChange: false,\r\n        }\r\n\r\n        userList.push(newData);\r\n      }\r\n\r\n      callback(userList);\r\n    } else {\r\n      callback([])\r\n    }\r\n  }).catch((error) => {\r\n    console.error(error);\r\n  });\r\n}\r\n\r\nexport const AllUser = async (callback) => {\r\n  let isActives = {};\r\n  let isAdmins = {};\r\n  let isSuperAdmins = {};\r\n\r\n  await getAsync(ref(db, \"isActive\")).then((snapshot) => {\r\n    if (snapshot.exists() && (typeof snapshot.val()) === \"object\") {\r\n      isActives = snapshot.val();\r\n    }\r\n  })\r\n\r\n  await getAsync(ref(db, \"isAdmin\")).then((snapshot) => {\r\n    if (snapshot.exists() && (typeof snapshot.val()) === \"object\") {\r\n      isAdmins = snapshot.val();\r\n    }\r\n  })\r\n\r\n  await getAsync(ref(db, \"isSuperAdmin\")).then((snapshot) => {\r\n    if (snapshot.exists() && (typeof snapshot.val()) === \"object\") {\r\n      isSuperAdmins = snapshot.val();\r\n    }\r\n  })\r\n\r\n  await getAsync(ref(db, \"users\")).then((snapshot) => {\r\n    if (snapshot.exists()) {\r\n      const userData = snapshot.val();\r\n      const userIds = Object.keys(userData);\r\n      let userList = [];\r\n\r\n      for (let i = 0; i < userIds.length; i++) {\r\n\r\n        const oldData = userData[userIds[i]];\r\n        if (isSuperAdmins[userIds[i]]) continue;\r\n\r\n        let newData = {\r\n          Id: userIds[i],\r\n          email: oldData.email || false,\r\n          isActive: isActives[userIds[i]] || false,\r\n          isAdmin: isAdmins[userIds[i]] || false,\r\n          isChange: false,\r\n        }\r\n\r\n        userList.push(newData);\r\n      }\r\n\r\n      callback(userList);\r\n    } else {\r\n      callback([])\r\n    }\r\n  }).catch((error) => {\r\n    console.error(error);\r\n  });\r\n}\r\n\r\nexport const UpdateAllGeneralUserAuth = (users, callback, errorCallback) => {\r\n  try {\r\n    for (let i = 0; i < users.length; i++) {\r\n      const oldData = users[i];\r\n      if (oldData.isChange) set(ref(db, `isActive/${oldData.Id}`), oldData.isActive)\r\n    }\r\n    callback();\r\n  } catch (error) {\r\n    errorCallback(error)\r\n  }\r\n}\r\n\r\nexport const UpdateAllUserAuth = (users, callback, errorCallback) => {\r\n  try {\r\n    for (let i = 0; i < users.length; i++) {\r\n      const oldData = users[i];\r\n      if (oldData.isChange) {\r\n        set(ref(db, `isActive/${oldData.Id}`), oldData.isActive)\r\n        set(ref(db, `isAdmin/${oldData.Id}`), oldData.isAdmin)\r\n      }\r\n    }\r\n    callback();\r\n  } catch (error) {\r\n    errorCallback(error)\r\n  }\r\n}\r\n\r\nexport const AddActivity = (id, data, callback, errorCallback) => {\r\n  set(ref(db, `activity/${id}`), {...data,time:new Date().getTime()}).then(_ => callback()).catch(_ => errorCallback());\r\n}\r\n\r\nexport const EditActivity = (id, data, callback, errorCallback) => {\r\n  set(ref(db, `activity/${id}`), {...data,time:new Date().getTime()}).then(_ => callback()).catch(errorCallback);\r\n}\r\n\r\nexport const ActivityCount = (callback) => {\r\n  get(ref(db, `activity/`)).then((snapshot) => {\r\n    if (snapshot.exists()) {\r\n      callback(Object.keys(snapshot.val()).length);\r\n    } else {\r\n      callback(0)\r\n    }\r\n  }).catch((error) => {\r\n    console.error(error);\r\n  });\r\n}\r\n\r\nexport const JoinActivity = async (callback) => {\r\n  await canActivate();\r\n  getAsync(ref(db, `activity`)).then((snapshot) => {\r\n    if (snapshot.exists()) {\r\n      const originData = snapshot.val().map((e, index) => ({ ...e, date: TimeToISOString(e.date), id: index }));\r\n      const filterSortData = originData.filter(e => new Date(Today()) <= new Date(e.date)).sort((a, b) => a.date < b.date ? 1 : -1);\r\n      callback(filterSortData);\r\n    } else {\r\n      callback([]);\r\n    }\r\n  }).catch((error) => {\r\n    console.error(error);\r\n  });\r\n}\r\n\r\nexport const AllActivity = async (callback) => {\r\n  await canActivate();\r\n  getAsync(ref(db, `activity`)).then((snapshot) => {\r\n    if (snapshot.exists()) {\r\n      const originData = snapshot.val().map((e, index) => ({ ...e,date: TimeToISOString(e.date), id: index, }));\r\n      callback(originData.sort((a, b) => a.date < b.date ? 1 : -1));\r\n    } else {\r\n      callback([]);\r\n    }\r\n  }).catch((error) => {\r\n    console.error(error);\r\n  });\r\n}\r\n\r\nexport const ActivityInfo = (id, callback) => {\r\n  getAsync(ref(db, `activity/${id}`)).then((snapshot) => {\r\n    if (snapshot.exists()) {\r\n      const data=snapshot.val();\r\n      callback({\r\n        name:data.name,\r\n        date:new Date(data.date).toISOString().split(\"T\")[0],\r\n      });\r\n    } else {\r\n      callback([]);\r\n    }\r\n  }).catch((error) => {\r\n    console.error(error);\r\n  });\r\n}\r\n\r\nexport const GetJoin = async (id, callback, errorCallback) => {\r\n  await canActivate();\r\n\r\n  const currentUser = auth.currentUser;\r\n  getAsync(ref(db, `join/${id}/${currentUser.uid}`)).then((snapshot) => {\r\n    if (snapshot.exists()) {\r\n      callback(snapshot.val());\r\n    } else {\r\n      callback(\r\n        [{\r\n          name: \"\",\r\n          birthday: \"\",\r\n          light1: false,\r\n          light2: false\r\n        },]\r\n      );\r\n    }\r\n  }).catch((error) => {\r\n    errorCallback(error)\r\n  });\r\n}\r\n\r\nexport const SentJoin = (id, data, callback, errorCallback) => {\r\n  const currentUser = auth.currentUser;\r\n  set(ref(db, `join/${id}/${currentUser.uid}`), data).then(_ => callback()).catch(_ => errorCallback());\r\n}\r\n\r\n\r\nexport const GetAllJoin = async (id, callback, errorCallback) => {\r\n  await canActivate();\r\n\r\n  getAsync(ref(db, `join/${id}`)).then((snapshot) => {\r\n    if (snapshot.exists()) {\r\n      const allOldData = snapshot.val();\r\n      const dataKey = Object.keys(allOldData);\r\n\r\n      let allNewData = [];\r\n      for (let i = 0; i < dataKey.length; i++) {\r\n        allNewData = allNewData.concat(allOldData[dataKey[i]]);\r\n      }\r\n\r\n      callback(allNewData);\r\n    } else {\r\n      callback(\r\n        []\r\n      );\r\n    }\r\n  }).catch((error) => {\r\n    errorCallback(error)\r\n  });\r\n}\r\n\r\n\r\nexport const SaveTemplate = async (data, callback, errorCallback) => {\r\n  await canActivate();\r\n  const currentUser = auth.currentUser;\r\n  set(ref(db, `template/${currentUser.uid}`), data).then(_ => callback()).catch(_ => errorCallback());\r\n}\r\n\r\nexport const LoadTemplate = async (callback, errorCallback) => {\r\n  await canActivate();\r\n  const currentUser = auth.currentUser;\r\n  getAsync(ref(db, `template/${currentUser.uid}`)).then((snapshot) => {\r\n    if (snapshot.exists()) {\r\n      callback(snapshot.val());\r\n    } else {\r\n      throw new Error('nodata');\r\n    }\r\n  }).catch((error) => {\r\n    errorCallback(error)\r\n  });\r\n}\r\n\r\nexport const Today = () => {\r\n  let today = new Date();\r\n  return `${today.getFullYear()}-${(today.getMonth() + 1).toString().padStart(2, '0')}-${today.getDate()}`;\r\n}\r\n\r\nexport const TimeToISOString = (time) => {\r\n  return new Date(time).toISOString().split(\"T\")[0]\r\n}"],"names":["Create","props","NameChange","name","setState","target","value","DateChange","date","Certain","event","preventDefault","stopPropagation","validated","NameInvalid","DateInvalid","some","invaild","ActivityCount","result","id","AddActivity","state","Date","getTime","NotificationManager","Today","this","length","today","inputDate","noValidate","onSubmit","className","style","maxWidth","width","padding","as","Col","md","controlId","required","type","placeholder","onChange","isInvalid","top","left","tooltip","to","React","auth","getAuth","canActivate","Promise","resolve","currentUser","unsubscribe","onAuthStateChanged","user","getAsync","ref","reject","onValue","snap","error","onlyOnce","db","getDatabase","AllGeneralUser","callback","isActives","isAdmins","isSuperAdmins","then","snapshot","exists","val","userData","userIds","Object","keys","userList","i","oldData","newData","Id","email","isActive","isAdmin","isChange","push","catch","console","AllUser","UpdateAllGeneralUserAuth","users","errorCallback","set","UpdateAllUserAuth","data","time","_","EditActivity","get","JoinActivity","filterSortData","map","e","index","TimeToISOString","filter","sort","a","b","AllActivity","originData","ActivityInfo","toISOString","split","GetJoin","uid","birthday","light1","light2","SentJoin","GetAllJoin","allOldData","dataKey","allNewData","concat","SaveTemplate","LoadTemplate","Error","getFullYear","getMonth","toString","padStart","getDate"],"sourceRoot":""}